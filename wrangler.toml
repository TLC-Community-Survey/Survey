name = "tlcsurvey"
compatibility_date = "2024-01-01"

# Pages configuration - this tells Cloudflare this is a Pages project
pages_build_output_dir = "dist"

# Explicitly disable Worker mode
# Do NOT include a "main" field - that would make it a Worker
# The /functions directory contains Pages Functions, not a Worker script

# D1 Database bindings
# Staging database - receives all raw submissions
[[d1_databases]]
binding = "DB_STAGING"
database_name = "tlc-survey-db-staging"
database_id = "e556fdc3-22c6-4c8c-800b-31498ad9d8ad" # Existing DB becomes staging

# Production database - contains sanitized data for dashboard
[[d1_databases]]
binding = "DB_PROD"
database_name = "tlc-survey-db-prod"
database_id = "PLACEHOLDER_DB_ID" # TODO: Create with: wrangler d1 create tlc-survey-db-prod

# Legacy binding for backward compatibility during migration
[[d1_databases]]
binding = "DB"
database_name = "tlc-survey-db"
database_id = "e556fdc3-22c6-4c8c-800b-31498ad9d8ad"

# KV Namespace for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "e93a364198744d5d9b51cbcfb28b127f" 
preview_id = "e93a364198744d5d9b51cbcfb28b127f"

# Note: Cron triggers for Pages Functions are configured in Cloudflare Dashboard
# Go to: Pages → Your Project → Settings → Functions → Cron Triggers
# 
# Recommended cron triggers:
# - "0 * * * *" (hourly) → /api/sanitize (sanitization job)
# - "0 0 * * *" (daily) → /api/backup (backup job)
# 
# Alternatively, use Cloudflare Workers with cron triggers for more control

